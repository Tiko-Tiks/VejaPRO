<!DOCTYPE html>
<html lang="lt">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>VejaPRO – Administravimas</title>
    <link href="/static/admin-shared.css?v=3.0" rel="stylesheet" />
  </head>
  <body>
    <div class="admin-layout">
      <div id="sidebar-overlay" class="sidebar-overlay" aria-hidden="true"></div>
      <aside class="sidebar" id="admin-sidebar">
        <div class="sidebar-brand">
          <a href="/"><img src="/static/logo.png" alt="VejaPRO" /></a>
        </div>
        <nav>
          <ul class="sidebar-nav">
            <li><a href="/admin">Apžvalga</a></li>
            <li><a href="/admin/customers">Klientai</a></li>
            <li><a href="/admin/projects">Projektai</a></li>
            <li><a href="/admin/calls">Skambučiai</a></li>
            <li><a href="/admin/calendar">Kalendorius</a></li>
            <li><a href="/admin/audit">Auditas</a></li>
            <li><a href="/admin/margins">Maržos</a></li>
            <li><a href="/admin/finance">Finansai</a></li>
            <li><a href="/admin/ai">AI Monitor</a></li>
          </ul>
        </nav>
      </aside>
      <button id="sidebar-toggle" class="btn btn-ghost sidebar-toggle" type="button" aria-label="Atidaryti meniu">☰</button>

      <main class="main-content">
        <div class="page-header">
          <h1>Apžvalga</h1>
        </div>

        <div class="content-area">
          <div class="section">
            <div class="form-grid" style="grid-template-columns:1fr auto auto;align-items:end;">
              <div class="form-group">
                <label for="token">Bearer žetonas</label>
                <input id="token" type="password" placeholder="Įklijuokite JWT žetoną" />
              </div>
              <button class="btn btn-ghost" id="generateToken">Generuoti žetoną</button>
              <button class="btn btn-primary" id="saveToken">Išsaugoti</button>
            </div>
            <div class="hint" id="tokenStatus">Žetonas nenustatytas.</div>
          </div>

          <div class="section">
            <strong>Greitos nuorodos</strong>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:12px;">
              <div class="card">
                <div>Projektų sąrašas, priskyrimai, statusų perėjimai.</div>
                <div style="margin-top:8px;"><a href="/admin/projects" style="color:var(--accent);font-weight:600;">Atidaryti projektus</a></div>
              </div>
              <div class="card">
                <div>Skambučių užklausos ir būsenos.</div>
                <div style="margin-top:8px;"><a href="/admin/calls" style="color:var(--accent);font-weight:600;">Atidaryti skambučius</a></div>
              </div>
              <div class="card">
                <div>Susitikimų planavimas, kalendoriaus vaizdas.</div>
                <div style="margin-top:8px;"><a href="/admin/calendar" style="color:var(--accent);font-weight:600;">Atidaryti kalendorių</a></div>
              </div>
              <div class="card">
                <div>Audito žurnalas, eksportas.</div>
                <div style="margin-top:8px;"><a href="/admin/audit" style="color:var(--accent);font-weight:600;">Atidaryti auditą</a></div>
              </div>
              <div class="card">
                <div>Maržų taisyklių valdymas.</div>
                <div style="margin-top:8px;"><a href="/admin/margins" style="color:var(--accent);font-weight:600;">Atidaryti maržas</a></div>
              </div>
            </div>
          </div>

          <div class="section">
            <strong>Pastabos</strong>
            <div class="hint">Žetonas saugomas tik jūsų naršyklėje.</div>
            <div class="hint">Administravimo puslapiai apsaugoti IP leistinų sąrašu ir bearer žetonu.</div>
          </div>
        </div>
      </main>
    </div>

    <script src="/static/admin-shared.js?v=3.0"></script>
    <script>
      const tokenInput = document.getElementById("token");
      const tokenStatus = document.getElementById("tokenStatus");

      const loadToken = () => {
        const stored = Auth.get();
        if (!tokenInput.value && stored) {
          tokenInput.value = Auth.normalize(stored);
          tokenStatus.textContent = "Žetonas įkeltas iš naršyklės.";
        }
      };

      document.getElementById("saveToken").addEventListener("click", () => {
        const token = Auth.normalize(tokenInput.value);
        if (token) {
          Auth.set(token);
          tokenInput.value = token;
          tokenStatus.textContent = "Žetonas išsaugotas.";
        } else {
          Auth.remove();
          tokenStatus.textContent = "Žetonas ištrintas.";
        }
      });

      document.getElementById("generateToken").addEventListener("click", async () => {
        tokenStatus.textContent = "Generuojamas žetonas...";
        try {
          const token = await Auth.generate();
          if (token) {
            tokenInput.value = token;
            tokenStatus.textContent = "Žetonas sugeneruotas.";
          } else {
            tokenStatus.textContent = "Prieiga uždrausta arba generavimas nepavyko.";
          }
        } catch (err) {
          tokenStatus.textContent = "Tinklo klaida.";
        }
      });

      loadToken();
      initSidebar("/admin");
    </script>
  </body>
</html>
