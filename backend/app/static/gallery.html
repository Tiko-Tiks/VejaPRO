<!doctype html>
<html lang="lt">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Galerija – VejaPRO darbų pavyzdžiai</title>
    <meta
      name="description"
      content="Peržiūrėkite VejaPRO atliktus vejos įrengimo projektus su prieš ir po nuotraukomis."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400;1,600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/public-shared.css?v=1.1" />
    <style>
      /* Gallery page overrides */
      .gallery-hero {
        background: linear-gradient(160deg, var(--vp-primary-deep) 0%, var(--vp-primary) 40%, var(--vp-primary-dark) 100%);
        padding: 130px 0 56px;
        text-align: center;
        position: relative;
        overflow: hidden;
        color: #fff;
      }

      .gallery-hero::before {
        content: "";
        position: absolute;
        inset: 0;
        background: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='.04'/%3E%3C/svg%3E");
        background-size: 200px 200px;
        opacity: 0.5;
        pointer-events: none;
      }

      .gallery-hero::after {
        content: "";
        position: absolute;
        width: 500px; height: 500px;
        border-radius: 999px;
        top: -250px; right: -100px;
        background: radial-gradient(circle, rgba(201, 154, 46, 0.12), transparent 70%);
        pointer-events: none;
      }

      .gallery-hero h1 {
        font-family: var(--vp-font-display);
        font-size: 48px;
        font-weight: 700;
        margin-bottom: 12px;
        line-height: 1.1;
        position: relative;
      }

      .gallery-hero p {
        font-size: 18px;
        color: rgba(255, 255, 255, 0.75);
        max-width: 700px;
        margin: 0 auto;
        line-height: 1.7;
        position: relative;
      }

      .hero-stats {
        margin-top: 28px;
        display: grid;
        grid-template-columns: repeat(3, minmax(100px, 1fr));
        gap: 14px;
        max-width: 640px;
        margin-left: auto;
        margin-right: auto;
        position: relative;
      }

      .hero-stat {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 14px;
        padding: 14px 10px;
        backdrop-filter: blur(8px);
      }

      .hero-stat strong {
        display: block;
        font-family: var(--vp-font-display);
        font-size: 26px;
        line-height: 1;
        margin-bottom: 3px;
        color: var(--vp-accent-light);
      }

      .hero-stat span {
        font-size: 11px;
        font-weight: 600;
        color: rgba(255, 255, 255, 0.6);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      /* Filters sticky bar */
      .filters-bar {
        padding: 20px 0;
        background: rgba(250, 249, 246, 0.96);
        border-bottom: 1px solid var(--vp-border-light);
        position: sticky;
        top: 65px;
        z-index: 90;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
      }

      /* Gallery content area */
      .gallery-content {
        padding: 48px 0 100px;
        min-height: 50vh;
        background: var(--vp-bg);
      }

      /* Gallery CTA bottom */
      .gallery-bottom-cta {
        text-align: center;
        padding: 48px 0 0;
      }

      /* Responsive */
      @media (max-width: 968px) {
        .gallery-hero h1 { font-size: 36px; }
        .hero-stats { grid-template-columns: repeat(3, minmax(80px, 1fr)); }
        .filters-bar { top: 56px; padding: 16px 0; }
      }

      @media (max-width: 640px) {
        .gallery-hero { padding: 100px 0 40px; }
        .gallery-hero h1 { font-size: 28px; }
        .gallery-hero p { font-size: 15px; }
        .hero-stats { grid-template-columns: 1fr; max-width: 240px; }
      }
    </style>
  </head>
  <body>
    <!-- ── Header ── -->
    <header class="vp-header scrolled">
      <div class="vp-container">
        <div class="vp-header-inner">
          <a href="/" class="vp-logo">
            <img src="/static/logo.png" alt="VejaPRO" />
          </a>

          <nav class="vp-nav">
            <a href="/">Pradžia</a>
            <a href="/gallery" style="color: var(--vp-primary); font-weight: 700;">Galerija</a>
            <a href="/#kontaktai">Kontaktai</a>
          </nav>

          <div class="vp-header-auth">
            <a href="/login" class="vp-auth-link">Prisijungti</a>
            <a href="/#kontaktai" class="vp-btn vp-btn-primary vp-btn-sm">Gauti pasiūlymą</a>
          </div>

          <button class="vp-hamburger" aria-label="Meniu">
            <span></span><span></span><span></span>
          </button>
        </div>
      </div>
    </header>

    <!-- Mobile menu -->
    <div class="vp-mobile-menu">
      <a href="/">Pradžia</a>
      <a href="/gallery">Galerija</a>
      <a href="/#kontaktai">Kontaktai</a>
      <a href="/login">Prisijungti</a>
      <a href="/#kontaktai" class="vp-btn vp-btn-primary" style="margin-top: 12px;">Gauti pasiūlymą</a>
    </div>

    <main>
      <!-- ── Hero ── -->
      <section class="gallery-hero">
        <div class="vp-container">
          <h1>Mūsų projektų galerija</h1>
          <p>Peržiūrėkite atliktus vejos įrengimo projektus su prieš ir po nuotraukomis. Paspausti ant kortelės — pamatysite pokyčio detalę.</p>
          <div class="hero-stats">
            <div class="hero-stat">
              <strong id="statProjects">0</strong>
              <span>Projektų</span>
            </div>
            <div class="hero-stat">
              <strong id="statFeatured">0</strong>
              <span>Išskirtiniai</span>
            </div>
            <div class="hero-stat">
              <strong id="statLocations">0</strong>
              <span>Regionai</span>
            </div>
          </div>
        </div>
      </section>

      <!-- ── Filters ── -->
      <section class="filters-bar">
        <div class="vp-container">
          <div class="vp-filters" id="filterContainer">
            <button class="vp-filter-btn active" data-filter="all">Visi projektai</button>
            <button class="vp-filter-btn" data-filter="featured">Išskirtiniai</button>
            <!-- Location filters injected dynamically -->
          </div>
        </div>
      </section>

      <!-- ── Gallery grid ── -->
      <section class="gallery-content">
        <div class="vp-container-wide">
          <div id="galleryGrid"></div>
          <div id="scrollSentinel" style="height: 1px;"></div>
        </div>

        <div class="gallery-bottom-cta vp-container">
          <a href="/#kontaktai" class="vp-btn vp-btn-primary">Gauti pasiūlymą</a>
        </div>
      </section>
    </main>

    <!-- ── Footer ── -->
    <footer class="vp-footer">
      <div class="vp-container">
        <div class="vp-footer-bottom" style="border: none; padding-top: 0;">
          <span>&copy; 2026 UAB VejaPRO. Visos teisės saugomos.</span>
          <a href="mailto:info@vejapro.lt">info@vejapro.lt</a>
        </div>
      </div>
    </footer>

    <!-- ── Mobile sticky bar ── -->
    <div class="vp-sticky-bar">
      <a href="tel:+37065849514" class="vp-btn vp-btn-outline vp-btn-sm">Skambinti</a>
      <a href="/#kontaktai" class="vp-btn vp-btn-primary vp-btn-sm">Gauti pasiūlymą</a>
    </div>

    <script src="/static/public-shared.js?v=1.1"></script>
    <script>
      "use strict";

      class GalleryPage {
        constructor() {
          this.gridEl = document.getElementById("galleryGrid");
          this.cursor = null;
          this.hasMore = true;
          this.loading = false;
          this.items = [];
          this.filter = "all";
          this.limit = 24;
          this.statProjects = document.getElementById("statProjects");
          this.statFeatured = document.getElementById("statFeatured");
          this.statLocations = document.getElementById("statLocations");
          this.init();
        }

        init() {
          this.setupFilters();
          this.setupScroll();
          this.load();
        }

        setupFilters() {
          document.getElementById("filterContainer").addEventListener("click", (e) => {
            const btn = e.target.closest(".vp-filter-btn");
            if (!btn) return;
            document.querySelectorAll(".vp-filter-btn").forEach((b) => b.classList.remove("active"));
            btn.classList.add("active");
            this.filter = btn.dataset.filter;
            this.reset();
            this.load();
          });
        }

        setupScroll() {
          const sentinel = document.getElementById("scrollSentinel");
          const obs = new IntersectionObserver(
            (entries) => {
              entries.forEach((entry) => {
                if (entry.isIntersecting && this.hasMore && !this.loading) {
                  this.load();
                }
              });
            },
            { threshold: 0.5 },
          );
          obs.observe(sentinel);
        }

        reset() {
          this.cursor = null;
          this.hasMore = true;
          this.items = [];
          this.gridEl.innerHTML = "";
          this.updateStats();
        }

        async load() {
          if (this.loading || !this.hasMore) return;
          this.loading = true;
          this.showLoader();

          try {
            const params = new URLSearchParams({ limit: this.limit });
            if (this.cursor) params.append("cursor", this.cursor);
            if (this.filter === "featured") params.append("featured_only", "true");
            else if (this.filter !== "all") params.append("location_tag", this.filter);

            const resp = await fetch(`/api/v1/gallery?${params}`);
            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
            const data = await resp.json();

            this.items = [...this.items, ...data.items];
            this.cursor = data.next_cursor;
            this.hasMore = data.has_more;
            this.updateStats();
            this.hideLoader();
            this.renderItems(data.items);

            if (this.items.length === 0) this.showEmpty();
          } catch (err) {
            console.error("Gallery load error:", err);
            this.hideLoader();
            this.showError("Nepavyko užkrauti galerijos. Bandykite vėliau.");
          } finally {
            this.loading = false;
          }
        }

        renderItems(items) {
          const grid = this.gridEl.querySelector(".vp-photo-grid") || this.createGrid();
          items.forEach((item) => grid.appendChild(this.createCard(item)));
        }

        createGrid() {
          const g = document.createElement("div");
          g.className = "vp-photo-grid";
          this.gridEl.appendChild(g);
          return g;
        }

        createCard(item) {
          const card = document.createElement("div");
          card.className = "vp-photo-card" + (item.is_featured ? " featured" : "");

          const ph = document.createElement("div");
          ph.className = "img-placeholder";
          card.appendChild(ph);

          const img = document.createElement("img");
          img.src = item.thumbnail_url || item.after_url || "";
          img.alt = item.location_tag || "VejaPRO projektas";
          img.loading = "lazy";
          img.className = "loading";
          if (item.thumbnail_url && item.thumbnail_url !== item.after_url) {
            img.srcset = `${item.thumbnail_url} 400w, ${item.after_url} 1200w`;
            img.sizes = "(max-width: 600px) 100vw, (max-width: 900px) 50vw, 33vw";
          }
          img.onload = function () {
            this.classList.remove("loading");
            if (ph.parentNode) ph.remove();
          };
          card.appendChild(img);

          if (item.is_featured) {
            const badge = document.createElement("div");
            badge.className = "vp-badge vp-badge-featured";
            badge.textContent = "Išskirtinis";
            card.appendChild(badge);
          }

          if (item.location_tag) {
            const loc = document.createElement("div");
            loc.className = "vp-badge vp-badge-location";
            loc.textContent = item.location_tag;
            card.appendChild(loc);
          }

          const overlay = document.createElement("div");
          overlay.className = "overlay";
          const oc = document.createElement("div");
          oc.className = "overlay-text";
          oc.textContent = item.before_url ? "Peržiūrėti prieš / po" : "Peržiūrėti";
          overlay.appendChild(oc);
          if (item.location_tag) {
            const ol = document.createElement("div");
            ol.className = "overlay-location";
            ol.textContent = item.location_tag;
            overlay.appendChild(ol);
          }
          card.appendChild(overlay);

          card.addEventListener("click", () => window.VPLightbox.open(item));
          return card;
        }

        showLoader() {
          const ld = document.createElement("div");
          ld.id = "galleryLoader";
          ld.className = "vp-loader";
          ld.innerHTML = '<div class="vp-loader-spinner"></div><div>Kraunama...</div>';
          this.gridEl.appendChild(ld);
        }

        hideLoader() {
          const el = document.getElementById("galleryLoader");
          if (el) el.remove();
        }

        showError(msg) {
          const d = document.createElement("div");
          d.style.cssText = "padding:24px;background:var(--vp-error-bg);border:2px solid rgba(220,38,38,.3);border-radius:var(--vp-radius);color:#991b1b;text-align:center;margin:40px auto;max-width:600px;font-weight:500;";
          d.textContent = msg;
          this.gridEl.appendChild(d);
        }

        showEmpty() {
          const d = document.createElement("div");
          d.className = "vp-empty";
          d.innerHTML = `
            <div class="vp-empty-icon">&#127793;</div>
            <h3>Projektų nerasta</h3>
            <p>Šiuo metu nėra projektų pagal pasirinktą filtrą.</p>
            <button class="vp-btn vp-btn-outline vp-btn-sm" style="margin-top:16px" onclick="document.querySelector('.vp-filter-btn[data-filter=all]').click()">Išvalyti filtrus</button>
          `;
          this.gridEl.appendChild(d);
        }

        updateStats() {
          const p = this.items.length;
          const f = this.items.filter((i) => i.is_featured).length;
          const l = new Set(this.items.map((i) => (i.location_tag || "").trim()).filter(Boolean)).size;
          if (this.statProjects) this.statProjects.textContent = String(p);
          if (this.statFeatured) this.statFeatured.textContent = String(f);
          if (this.statLocations) this.statLocations.textContent = String(l);
        }
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", () => new GalleryPage());
      } else {
        new GalleryPage();
      }
    </script>
  </body>
</html>
