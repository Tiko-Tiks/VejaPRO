<!doctype html>
<html lang="lt">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Galerija ‚Äì VejaPRO Projektai</title>
    <meta
      name="description"
      content="Per≈æi≈´rƒókite m≈´s≈≥ atliktus vejos ƒØrengimo projektus. Prie≈° ir po nuotraukos su eksperto sertifikavimu."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary: #1f6b45;
        --primary-light: #3f8a63;
        --primary-dark: #124028;
        --accent: #f59f00;
        --text-primary: #111827;
        --text-secondary: #4b5563;
        --bg-white: #ffffff;
        --bg-light: #f3f7f3;
        --bg-mist: #eef5f0;
        --border: #d8e3db;
        --shadow-sm: 0 8px 20px rgba(12, 23, 17, 0.08);
        --shadow-md: 0 16px 35px rgba(12, 23, 17, 0.13);
        --shadow-lg: 0 24px 60px rgba(0, 0, 0, 0.24);
        --radius: 16px;
        --spacing: 80px;
      }

      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }

      @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Space Grotesk', 'Segoe UI', sans-serif;
        color: var(--text-primary);
        background:
          radial-gradient(1200px 520px at 10% -6%, #d5eadc 0%, transparent 60%),
          radial-gradient(900px 420px at 100% 0%, #cbe2d3 0%, transparent 55%),
          var(--bg-mist);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        scroll-behavior: smooth;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 24px;
      }

      .container-wide {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 24px;
      }

      header {
        background: rgba(255, 255, 255, 0.88);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(14px);
      }

      .header-content {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px 0;
      }

      .logo {
        display: flex;
        align-items: center;
        text-decoration: none;
      }

      .logo img {
        height: 32px;
        width: auto;
        display: block;
      }

      .nav {
        display: flex;
        gap: 32px;
        align-items: center;
      }

      .nav a {
        color: var(--text-secondary);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
      }

      .nav a:hover,
      .nav a.active {
        color: var(--primary);
      }

      .hero-section {
        background: linear-gradient(148deg, #f6fbf7 0%, #e7f2ea 48%, #fef9f1 100%);
        border-bottom: 1px solid var(--border);
        padding: 84px 0 56px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .hero-section::after {
        content: "";
        position: absolute;
        width: 420px;
        height: 420px;
        border-radius: 999px;
        top: -210px;
        right: -80px;
        background: radial-gradient(circle, rgba(31, 107, 69, 0.14), transparent 70%);
        pointer-events: none;
      }

      .hero-kicker {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 7px 14px;
        margin-bottom: 16px;
        background: rgba(31, 107, 69, 0.08);
        border: 1px solid rgba(31, 107, 69, 0.2);
        color: var(--primary-dark);
        border-radius: 999px;
        font-size: 13px;
        font-weight: 700;
        letter-spacing: 0.04em;
        text-transform: uppercase;
      }

      .hero-section h1 {
        font-size: 52px;
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 12px;
        line-height: 1.1;
        letter-spacing: -0.03em;
      }

      .hero-section p {
        font-size: 18px;
        color: var(--text-secondary);
        max-width: 760px;
        margin: 0 auto;
        line-height: 1.6;
      }

      .hero-stats {
        margin-top: 28px;
        display: grid;
        grid-template-columns: repeat(3, minmax(120px, 1fr));
        gap: 12px;
        max-width: 720px;
        margin-left: auto;
        margin-right: auto;
      }

      .hero-stat {
        background: rgba(255, 255, 255, 0.75);
        border: 1px solid rgba(255, 255, 255, 0.9);
        border-radius: 14px;
        padding: 14px 12px;
        backdrop-filter: blur(8px);
      }

      .hero-stat strong {
        display: block;
        font-size: 24px;
        line-height: 1;
        margin-bottom: 4px;
        color: var(--primary-dark);
      }

      .hero-stat span {
        font-size: 12px;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .filters-section {
        padding: 24px 0;
        background: rgba(255, 255, 255, 0.92);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 73px;
        z-index: 90;
        backdrop-filter: blur(8px);
      }

      .filters-container {
        display: flex;
        gap: 16px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
      }

      .filter-btn {
        padding: 11px 20px;
        border: 1px solid var(--border);
        background: linear-gradient(180deg, #ffffff 0%, #f7fbf7 100%);
        color: var(--text-primary);
        border-radius: 999px;
        font-weight: 600;
        font-size: 15px;
        cursor: pointer;
        transition: all 0.25s ease;
        font-family: inherit;
      }

      .filter-btn:hover {
        border-color: var(--primary);
        transform: translateY(-2px);
        box-shadow: var(--shadow-sm);
      }

      .filter-btn.active {
        background: linear-gradient(145deg, var(--primary) 0%, var(--primary-light) 100%);
        color: white;
        border-color: var(--primary);
        box-shadow: 0 10px 22px rgba(31, 107, 69, 0.28);
      }

      .gallery-section {
        padding: 52px 0 100px;
        min-height: 60vh;
      }

      .photo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        grid-auto-flow: dense;
        margin-bottom: 40px;
      }

      .photo-card {
        position: relative;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        transition: all 0.3s ease;
        cursor: pointer;
        background: var(--bg-light);
        aspect-ratio: 5/4;
        border: 1px solid var(--border);
      }

      .photo-card.featured {
        border-color: rgba(245, 159, 0, 0.35);
        box-shadow: 0 16px 32px rgba(245, 159, 0, 0.2);
      }

      .photo-grid .photo-card:nth-child(7n + 1) {
        grid-column: span 2;
      }

      .photo-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-md);
        border-color: var(--primary-light);
      }

      .photo-card img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .photo-card .overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
        padding: 20px;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .photo-card:hover .overlay {
        opacity: 1;
      }

      .overlay-content {
        color: white;
      }

      .overlay-title {
        font-weight: 600;
        font-size: 16px;
        margin-bottom: 4px;
      }

      .overlay-location {
        font-size: 14px;
        opacity: 0.9;
      }

      .featured-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        background: rgba(245, 159, 0, 0.94);
        color: #211000;
        border: 1px solid rgba(255, 221, 145, 0.9);
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 600;
        backdrop-filter: blur(4px);
        z-index: 2;
      }

      .location-tag {
        position: absolute;
        bottom: 12px;
        left: 12px;
        background: rgba(255, 255, 255, 0.92);
        border: 1px solid rgba(255, 255, 255, 0.95);
        padding: 6px 12px;
        border-radius: 12px;
        font-size: 13px;
        font-weight: 600;
        backdrop-filter: blur(4px);
        z-index: 2;
      }

      .loader {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-secondary);
      }

      .loader-spinner {
        display: inline-block;
        width: 48px;
        height: 48px;
        border: 4px solid var(--border);
        border-top-color: var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 16px;
      }

      @keyframes spin {
        to { transform: rotate(360deg); }
      }

      .loader-text {
        font-size: 16px;
        font-weight: 500;
      }

      .error-message {
        padding: 24px;
        background: rgba(220, 38, 38, 0.1);
        border: 2px solid rgba(220, 38, 38, 0.3);
        border-radius: var(--radius);
        color: #991b1b;
        text-align: center;
        margin: 40px auto;
        max-width: 600px;
        font-weight: 500;
      }

      .empty-state {
        text-align: center;
        padding: 80px 20px;
        color: var(--text-secondary);
      }

      .empty-state-icon {
        font-size: 64px;
        margin-bottom: 16px;
        opacity: 0.5;
      }

      .empty-state h3 {
        font-size: 24px;
        color: var(--text-primary);
        margin-bottom: 8px;
      }

      .empty-state p {
        font-size: 16px;
      }

      .lightbox {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        cursor: pointer;
        animation: fadeIn 0.2s ease;
      }

      .lightbox-content {
        position: relative;
        max-width: 90%;
        max-height: 90%;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .lightbox-slider {
        position: relative;
        width: 100%;
        max-width: 1200px;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      }

      .slider-container {
        position: relative;
        width: 100%;
        height: 600px;
        overflow: hidden;
        user-select: none;
      }

      .slider-container img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        pointer-events: none;
      }

      .after-image {
        clip-path: inset(0 50% 0 0);
      }

      .slider-handle {
        position: absolute;
        top: 0;
        left: 50%;
        width: 4px;
        height: 100%;
        background: white;
        cursor: ew-resize;
        transform: translateX(-50%);
        z-index: 10;
      }

      .slider-button {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 48px;
        height: 48px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: ew-resize;
        z-index: 11;
      }

      .slider-button::before,
      .slider-button::after {
        content: '';
        position: absolute;
        width: 0;
        height: 0;
        border-style: solid;
      }

      .slider-button::before {
        border-width: 8px 12px 8px 0;
        border-color: transparent var(--primary) transparent transparent;
        left: 12px;
      }

      .slider-button::after {
        border-width: 8px 0 8px 12px;
        border-color: transparent transparent transparent var(--primary);
        right: 12px;
      }

      .slider-label {
        position: absolute;
        top: 20px;
        padding: 8px 16px;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        z-index: 12;
      }

      .slider-label.before {
        left: 20px;
        color: var(--text-secondary);
      }

      .slider-label.after {
        right: 20px;
        color: var(--primary);
      }

      .lightbox-info {
        margin-top: 20px;
        text-align: center;
        color: white;
      }

      .lightbox-location {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .lightbox-close {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 24px;
        color: var(--text-primary);
        transition: all 0.2s ease;
        z-index: 13;
      }

      .lightbox-close:hover {
        background: white;
        transform: scale(1.1);
      }

      footer {
        background: var(--bg-light);
        padding: 40px 0;
        border-top: 1px solid var(--border);
      }

      .footer-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .footer-content p {
        color: var(--text-secondary);
        font-size: 14px;
      }

      .footer-content a {
        color: var(--primary);
        text-decoration: none;
      }

      @media (max-width: 968px) {
        .hero-section h1 {
          font-size: 40px;
        }
        .hero-section p {
          font-size: 18px;
        }
        .hero-stats {
          grid-template-columns: repeat(3, minmax(80px, 1fr));
        }
        .photo-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }
        .photo-grid .photo-card:nth-child(7n + 1) {
          grid-column: span 1;
        }
        .slider-container {
          height: 400px;
        }
        .filters-section {
          top: 65px;
          padding: 30px 0;
        }
        .filter-btn {
          padding: 10px 18px;
          font-size: 14px;
        }
      }

      @media (max-width: 640px) {
        .hero-section h1 {
          font-size: 32px;
        }
        .hero-section p {
          font-size: 16px;
        }
        .hero-stats {
          grid-template-columns: 1fr;
          max-width: 280px;
        }
        .filter-btn { padding: 12px 18px; min-height: 44px; font-size: 14px; }
        .btn, .btn-primary { padding: 12px 18px; min-height: 44px; }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <a href="/" class="logo"><img src="/static/logo.png" alt="VejaPRO" /></a>
          <nav class="nav">
            <a href="/">Prad≈æia</a>
            <a href="/gallery" class="active">Galerija</a>
            <a href="/#kontaktai">Kontaktai</a>
            <a href="/client">Klientas</a>
            <a href="/admin">Administravimas</a>
          </nav>
        </div>
      </div>
    </header>

    <main>
      <section class="hero-section">
        <div class="container">
          <div class="hero-kicker">Sertifikuoti darbai visoje Lietuvoje</div>
          <h1>M≈´s≈≥ projekt≈≥ galerija</h1>
          <p>Per≈æi≈´rƒókite atliktus vejos ƒØrengimo projektus su prie≈° ir po nuotraukomis. Visi projektai sertifikuoti agronomo.</p>
          <div class="hero-stats">
            <div class="hero-stat">
              <strong id="statProjects">0</strong>
              <span>Projekt≈≥</span>
            </div>
            <div class="hero-stat">
              <strong id="statFeatured">0</strong>
              <span>I≈°skirtiniai</span>
            </div>
            <div class="hero-stat">
              <strong id="statLocations">0</strong>
              <span>Regionai</span>
            </div>
          </div>
        </div>
      </section>

      <section class="filters-section">
        <div class="container">
          <div class="filters-container">
            <button class="filter-btn active" data-filter="all">Visi projektai</button>
            <button class="filter-btn" data-filter="featured">‚≠ê I≈°skirtiniai</button>
            <button class="filter-btn" data-filter="vilnius">üìç Vilnius</button>
            <button class="filter-btn" data-filter="kaunas">üìç Kaunas</button>
            <button class="filter-btn" data-filter="klaipeda">üìç Klaipƒóda</button>
          </div>
        </div>
      </section>

      <section class="gallery-section">
        <div class="container-wide">
          <div id="galleryContainer"></div>
          <div id="scrollSentinel"></div>
        </div>
      </section>
    </main>

    <footer>
      <div class="container">
        <div class="footer-content">
          <p>¬© 2026 VejaPRO. Visos teisƒós saugomos.</p>
          <p>B≈´sena: <a href="/health">veikia</a> | <a href="/admin">Administravimas</a></p>
        </div>
      </div>
    </footer>

    <script>
      class GalleryManager {
        constructor() {
          this.container = document.getElementById('galleryContainer');
          this.cursor = null;
          this.hasMore = true;
          this.loading = false;
          this.items = [];
          this.currentFilter = 'all';
          this.limit = 24;
          this.statProjects = document.getElementById('statProjects');
          this.statFeatured = document.getElementById('statFeatured');
          this.statLocations = document.getElementById('statLocations');
          
          this.init();
        }

        init() {
          this.setupFilters();
          this.setupInfiniteScroll();
          this.loadGallery();
        }

        setupFilters() {
          const filterBtns = document.querySelectorAll('.filter-btn');
          filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
              filterBtns.forEach(b => b.classList.remove('active'));
              btn.classList.add('active');
              
              const filter = btn.dataset.filter;
              this.currentFilter = filter;
              this.reset();
              this.loadGallery();
            });
          });
        }

        reset() {
          this.cursor = null;
          this.hasMore = true;
          this.items = [];
          this.container.innerHTML = '';
          this.updateHeroStats();
        }

        async loadGallery() {
          if (this.loading || !this.hasMore) return;
          
          this.loading = true;
          this.showLoader();

          try {
            const params = new URLSearchParams({ limit: this.limit });
            
            if (this.cursor) params.append('cursor', this.cursor);
            
            if (this.currentFilter === 'featured') {
              params.append('featured_only', 'true');
            } else if (this.currentFilter !== 'all') {
              params.append('location_tag', this.currentFilter);
            }

            const response = await fetch(`/api/v1/gallery?${params}`);
            
            if (!response.ok) {
              throw new Error(`HTTP ${response.status}`);
            }
            
            const data = await response.json();
            
            this.items = [...this.items, ...data.items];
            this.cursor = data.next_cursor;
            this.hasMore = data.has_more;
            this.updateHeroStats();
            
            this.hideLoader();
            this.renderItems(data.items);
            
            if (this.items.length === 0) {
              this.showEmptyState();
            }
            
          } catch (error) {
            console.error('Gallery load error:', error);
            this.hideLoader();
            this.showError('Nepavyko u≈ækrauti galerijos. Bandykite vƒóliau.');
          } finally {
            this.loading = false;
          }
        }

        renderItems(items) {
          const grid = this.container.querySelector('.photo-grid') || this.createGrid();
          
          items.forEach(item => {
            const card = this.createCard(item);
            grid.appendChild(card);
          });
        }

        createGrid() {
          const grid = document.createElement('div');
          grid.className = 'photo-grid';
          this.container.appendChild(grid);
          return grid;
        }

        createCard(item) {
          const card = document.createElement('div');
          card.className = 'photo-card';
          if (item.is_featured) {
            card.classList.add('featured');
          }
          
          const img = document.createElement('img');
          img.src = item.after_url;
          img.alt = item.location_tag || 'VejaPRO projektas';
          img.loading = 'lazy';
          
          card.appendChild(img);
          
          if (item.is_featured) {
            const badge = document.createElement('div');
            badge.className = 'featured-badge';
            badge.textContent = '‚≠ê I≈°skirtinis';
            card.appendChild(badge);
          }
          
          if (item.location_tag) {
            const tag = document.createElement('div');
            tag.className = 'location-tag';
            tag.textContent = 'üìç ' + item.location_tag;
            card.appendChild(tag);
          }
          
          const overlay = document.createElement('div');
          overlay.className = 'overlay';
          const overlayContent = document.createElement('div');
          overlayContent.className = 'overlay-content';
          const overlayTitle = document.createElement('div');
          overlayTitle.className = 'overlay-title';
          overlayTitle.textContent = `Projektas #${item.project_id.substring(0, 8)}`;
          overlayContent.appendChild(overlayTitle);
          if (item.location_tag) {
            const overlayLocation = document.createElement('div');
            overlayLocation.className = 'overlay-location';
            overlayLocation.textContent = item.location_tag;
            overlayContent.appendChild(overlayLocation);
          }
          overlay.appendChild(overlayContent);
          card.appendChild(overlay);
          
          card.addEventListener('click', () => this.openLightbox(item));
          
          return card;
        }

        openLightbox(item) {
          const lightbox = document.createElement('div');
          lightbox.className = 'lightbox';
          
          const content = document.createElement('div');
          content.className = 'lightbox-content';
          
          const closeBtn = document.createElement('div');
          closeBtn.className = 'lightbox-close';
          closeBtn.innerHTML = '√ó';
          closeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            lightbox.remove();
          });
          
          if (item.before_url) {
            const slider = this.createBeforeAfterSlider(item);
            content.appendChild(slider);
          } else {
            const imgContainer = document.createElement('div');
            imgContainer.style.cssText = 'max-width: 1200px; border-radius: 12px; overflow: hidden; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);';
            const img = document.createElement('img');
            img.src = item.after_url;
            img.style.cssText = 'width: 100%; height: auto; display: block;';
            imgContainer.appendChild(img);
            content.appendChild(imgContainer);
          }
          
          if (item.location_tag || item.is_featured) {
            const info = document.createElement('div');
            info.className = 'lightbox-info';
            if (item.location_tag) {
              const location = document.createElement('div');
              location.className = 'lightbox-location';
              location.textContent = 'üìç ' + item.location_tag;
              info.appendChild(location);
            }
            if (item.is_featured) {
              const featured = document.createElement('div');
              featured.textContent = '‚≠ê I≈°skirtinis projektas';
              info.appendChild(featured);
            }
            content.appendChild(info);
          }
          
          content.appendChild(closeBtn);
          lightbox.appendChild(content);
          
          lightbox.addEventListener('click', (e) => {
            if (e.target === lightbox) {
              lightbox.remove();
            }
          });
          
          document.body.appendChild(lightbox);
        }

        createBeforeAfterSlider(item) {
          const sliderWrapper = document.createElement('div');
          sliderWrapper.className = 'lightbox-slider';
          
          const container = document.createElement('div');
          container.className = 'slider-container';
          
          const beforeImg = document.createElement('img');
          beforeImg.src = item.before_url;
          beforeImg.className = 'before-image';
          
          const afterImg = document.createElement('img');
          afterImg.src = item.after_url;
          afterImg.className = 'after-image';
          
          const handle = document.createElement('div');
          handle.className = 'slider-handle';
          
          const button = document.createElement('div');
          button.className = 'slider-button';
          handle.appendChild(button);
          
          const beforeLabel = document.createElement('div');
          beforeLabel.className = 'slider-label before';
          beforeLabel.textContent = 'Prie≈°';
          
          const afterLabel = document.createElement('div');
          afterLabel.className = 'slider-label after';
          afterLabel.textContent = 'Po';
          
          container.appendChild(beforeImg);
          container.appendChild(afterImg);
          container.appendChild(handle);
          container.appendChild(beforeLabel);
          container.appendChild(afterLabel);
          
          sliderWrapper.appendChild(container);
          
          let isDragging = false;
          
          const updateSlider = (clientX) => {
            const rect = container.getBoundingClientRect();
            const x = clientX - rect.left;
            const percent = Math.max(0, Math.min(100, (x / rect.width) * 100));
            
            handle.style.left = percent + '%';
            afterImg.style.clipPath = `inset(0 ${100 - percent}% 0 0)`;
          };
          
          const startDrag = (e) => {
            isDragging = true;
            updateSlider(e.clientX || e.touches[0].clientX);
          };
          
          const drag = (e) => {
            if (!isDragging) return;
            e.preventDefault();
            updateSlider(e.clientX || e.touches[0].clientX);
          };
          
          const stopDrag = () => {
            isDragging = false;
          };
          
          handle.addEventListener('mousedown', startDrag);
          container.addEventListener('mousedown', startDrag);
          document.addEventListener('mousemove', drag);
          document.addEventListener('mouseup', stopDrag);
          
          handle.addEventListener('touchstart', startDrag);
          container.addEventListener('touchstart', startDrag);
          document.addEventListener('touchmove', drag);
          document.addEventListener('touchend', stopDrag);
          
          return sliderWrapper;
        }

        showLoader() {
          const loader = document.createElement('div');
          loader.id = 'gallery-loader';
          loader.className = 'loader';
          loader.innerHTML = `
            <div class="loader-spinner"></div>
            <div class="loader-text">Kraunama galerija...</div>
          `;
          this.container.appendChild(loader);
        }

        hideLoader() {
          const loader = document.getElementById('gallery-loader');
          if (loader) loader.remove();
        }

        showError(message) {
          const error = document.createElement('div');
          error.className = 'error-message';
          error.textContent = message;
          this.container.appendChild(error);
        }

        showEmptyState() {
          const empty = document.createElement('div');
          empty.className = 'empty-state';
          empty.innerHTML = `
            <div class="empty-state-icon">üå±</div>
            <h3>Projekt≈≥ nerasta</h3>
            <p>≈†iuo metu nƒóra projekt≈≥ pagal pasirinktƒÖ filtrƒÖ.</p>
          `;
          this.container.appendChild(empty);
        }

        updateHeroStats() {
          const projects = this.items.length;
          const featured = this.items.filter(item => item.is_featured).length;
          const locations = new Set(
            this.items
              .map(item => (item.location_tag || '').trim())
              .filter(Boolean)
          ).size;

          if (this.statProjects) this.statProjects.textContent = String(projects);
          if (this.statFeatured) this.statFeatured.textContent = String(featured);
          if (this.statLocations) this.statLocations.textContent = String(locations);
        }

        setupInfiniteScroll() {
          const sentinel = document.getElementById('scrollSentinel');
          
          const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
              if (entry.isIntersecting && this.hasMore && !this.loading) {
                this.loadGallery();
              }
            });
          }, { threshold: 0.5 });
          
          observer.observe(sentinel);
        }
      }

      // Initialize gallery when DOM is ready
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
          new GalleryManager();
        });
      } else {
        new GalleryManager();
      }
    </script>
  </body>
</html>
