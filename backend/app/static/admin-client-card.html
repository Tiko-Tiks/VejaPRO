<!DOCTYPE html>
<html lang="lt" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex, nofollow" />
    <meta name="description" content="VejaPRO admin client card." />
    <title>VejaPRO - Kliento kortelė</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&display=swap"
    />
    <link rel="stylesheet" href="/static/admin-shared.css?v=6.9" />
    <style>
      /* Client card — Figma-inspired (Client Card Management) */
      .client-card-header { position: sticky; top: 0; z-index: 90; background: var(--surface); border-bottom: 1px solid var(--border); box-shadow: 0 1px 3px rgba(0,0,0,0.06); }
      .client-card-header .header-inner { max-width: 1280px; margin: 0 auto; padding: 12px 16px; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; }
      .client-card-header .back-link { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; font-size: 14px; font-weight: 500; color: var(--ink); text-decoration: none; border-radius: var(--radius); transition: background var(--transition-fast); }
      .client-card-header .back-link:hover { background: var(--surface-hover); }
      .client-card-header .title-row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
      .client-card-header .client-key-badge { font-size: 12px; font-family: var(--font-mono); color: var(--ink-muted); background: var(--surface-hover); padding: 4px 8px; border-radius: var(--radius-sm); }
      .what-now-block { background: var(--surface); border-left: 4px solid var(--blue); border-radius: var(--radius); box-shadow: 0 1px 2px rgba(0,0,0,0.04); margin-bottom: 16px; }
      .what-now-block .what-now-inner { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 12px; padding: 16px; }
      .what-now-block .what-now-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.02em; color: var(--ink-muted); margin-bottom: 4px; }
      .what-now-block .what-now-text { font-size: 15px; font-weight: 700; color: var(--ink-heading); }
      .what-now-block .what-now-cta { display: inline-flex; align-items: center; gap: 6px; padding: 10px 20px; font-size: 14px; font-weight: 700; color: #fff; background: var(--blue); border: none; border-radius: var(--radius); cursor: pointer; text-decoration: none; transition: opacity var(--transition-fast); }
      .what-now-block .what-now-cta:hover { opacity: 0.92; }
      .process-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 12px; }
      .process-cell { border: 1px solid var(--border); border-radius: var(--radius); padding: 10px 12px; }
      .process-cell .label { font-size: 11px; font-weight: 600; color: var(--ink-muted); margin-bottom: 4px; }
      .process-cell .value { font-size: 14px; font-weight: 700; color: var(--ink-heading); }
      .client-card-content { max-width: 1280px; margin: 0 auto; padding: 16px; }
    </style>
    <script>
      try {
        var t = localStorage.getItem("vejapro_theme") || "light";
        document.documentElement.dataset.theme = t;
      } catch (e) {}
    </script>
  </head>
  <body data-layout="topbar">
    <header class="client-card-header">
      <div class="header-inner">
        <div class="title-row">
          <a class="back-link" href="/admin">&larr; Grįžti</a>
          <h1 id="clientCardTitle">Kliento kortelė</h1>
          <span id="clientKeyBadge" class="client-key-badge" aria-hidden="true"></span>
        </div>
        <div class="actions">
          <button id="btnGeneratePricing" type="button" class="btn btn-secondary">Generuoti</button>
          <button id="btnApprovePricing" type="button" class="btn btn-primary">Patvirtinti</button>
          <button id="btnEditPricing" type="button" class="btn">Koreguoti</button>
          <button id="btnIgnorePricing" type="button" class="btn btn-ghost">Ignoruoti</button>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="content-area client-card-content">
        <div id="clientCardStatus" class="status-bar"></div>

        <div id="whatNowBlock" class="what-now-block" style="display: none;">
          <div class="what-now-inner">
            <div>
              <div class="what-now-label">Kas dabar?</div>
              <div id="whatNowText" class="what-now-text"></div>
            </div>
            <a id="whatNowCta" href="#" class="what-now-cta"></a>
          </div>
        </div>

        <section class="planner-panel" style="margin-bottom: 14px">
          <div class="planner-panel-header">
            <h2>Procesas ir būsena</h2>
          </div>
          <div class="process-grid">
            <div class="process-cell">
              <div class="label">Stadija</div>
              <div id="summaryStage" class="value">-</div>
            </div>
            <div class="process-cell">
              <div class="label">Depozitas</div>
              <div id="summaryDeposit" class="value">-</div>
            </div>
            <div class="process-cell">
              <div class="label">Kitas vizitas</div>
              <div id="summaryVisit" class="value">-</div>
            </div>
            <div class="process-cell">
              <div class="label">Uždirbta</div>
              <div id="summaryEarned" class="value">-</div>
            </div>
          </div>
          <div id="summaryFlags" style="margin-top: 10px"></div>
        </section>

        <section class="planner-panel" style="margin-bottom: 14px" id="aiPricingPanel">
          <div class="planner-panel-header" style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
            <h2>AI kainų pasiūlymas</h2>
            <span id="aiPricingNeedsDecisionBadge" class="pill pill-warning" style="display: none;">Reikia sprendimo</span>
          </div>
          <div id="pricingStatusLine" style="margin-bottom: 10px"></div>
          <div id="pricingDecisionBadge" style="display: none; margin-bottom: 10px"></div>
          <div id="pricingFallbackLine" style="display: none; margin-bottom: 10px" class="card"></div>
          <div class="form-grid">
            <div>
              <div class="section-subtitle">Bazine kaina</div>
              <div id="pricingBase">-</div>
            </div>
            <div>
              <div class="section-subtitle">AI korekcija</div>
              <div id="pricingAdjustment">-</div>
            </div>
            <div>
              <div class="section-subtitle">Final pasiūlymas</div>
              <div id="pricingFinal" style="font-weight: 700">-</div>
            </div>
            <div>
              <div class="section-subtitle">Kainos rezis</div>
              <div id="pricingRange">-</div>
            </div>
            <div>
              <div class="section-subtitle">Confidence</div>
              <div id="pricingConfidence">-</div>
            </div>
            <div>
              <div class="section-subtitle">Susiję projektai</div>
              <div id="pricingSimilar">-</div>
            </div>
          </div>
          <div class="section-subtitle" style="margin-top: 12px">Reasoning</div>
          <div id="pricingReasoning" class="card" style="padding: 10px; font-style: italic; color: var(--ink-muted)">-</div>
          <div class="section-subtitle" style="margin-top: 12px">Faktoriai</div>
          <div id="pricingFactors"></div>
          <div id="pricingTimestamp" style="margin-top: 8px; font-size: 11px; color: var(--ink-muted)"></div>
        </section>

        <details class="section" id="surveySection">
          <summary>Vietos anketa</summary>
          <div class="form-grid" style="margin-top: 10px">
            <div>
              <label class="section-subtitle" for="surveySoilType">Dirvožemis</label>
              <select id="surveySoilType" class="input">
                <option value="UNKNOWN">UNKNOWN</option>
                <option value="SAND">SAND</option>
                <option value="CLAY">CLAY</option>
                <option value="LOAM">LOAM</option>
                <option value="PEAT">PEAT</option>
              </select>
            </div>
            <div>
              <label class="section-subtitle" for="surveySlopeGrade">Nuolydis</label>
              <select id="surveySlopeGrade" class="input">
                <option value="FLAT">FLAT</option>
                <option value="GENTLE">GENTLE</option>
                <option value="MODERATE">MODERATE</option>
                <option value="STEEP">STEEP</option>
              </select>
            </div>
            <div>
              <label class="section-subtitle" for="surveyVegetation">Augalija</label>
              <select id="surveyVegetation" class="input">
                <option value="BARE">BARE</option>
                <option value="SPARSE_GRASS">SPARSE_GRASS</option>
                <option value="DENSE_GRASS">DENSE_GRASS</option>
                <option value="WEEDS">WEEDS</option>
                <option value="MIXED">MIXED</option>
              </select>
            </div>
            <div>
              <label class="section-subtitle" for="surveyAccess">Priejimas technikai</label>
              <select id="surveyAccess" class="input">
                <option value="EASY">EASY</option>
                <option value="RESTRICTED">RESTRICTED</option>
                <option value="DIFFICULT">DIFFICULT</option>
              </select>
            </div>
            <div>
              <label class="section-subtitle" for="surveyDistance">Atstumas km</label>
              <input id="surveyDistance" class="input" type="number" min="0" step="0.1" />
            </div>
            <div style="display: flex; align-items: center; gap: 8px">
              <input id="surveyIrrigation" type="checkbox" />
              <label for="surveyIrrigation">Yra laistymo sistema</label>
            </div>
          </div>
          <div style="margin-top: 12px">
            <div class="section-subtitle" style="margin-bottom: 6px">Kliūtys</div>
            <div id="surveyObstaclesGroup" style="display: flex; flex-wrap: wrap; gap: 8px 16px">
              <label style="display: flex; align-items: center; gap: 4px; font-size: 13px; cursor: pointer">
                <input type="checkbox" class="obstacle-cb" value="TREES" /> Medžiai
              </label>
              <label style="display: flex; align-items: center; gap: 4px; font-size: 13px; cursor: pointer">
                <input type="checkbox" class="obstacle-cb" value="FENCE" /> Tvora
              </label>
              <label style="display: flex; align-items: center; gap: 4px; font-size: 13px; cursor: pointer">
                <input type="checkbox" class="obstacle-cb" value="UTILITIES" /> Komunikacijos
              </label>
              <label style="display: flex; align-items: center; gap: 4px; font-size: 13px; cursor: pointer">
                <input type="checkbox" class="obstacle-cb" value="PAVERS" /> Trinkelės
              </label>
              <label style="display: flex; align-items: center; gap: 4px; font-size: 13px; cursor: pointer">
                <input type="checkbox" class="obstacle-cb" value="SLOPE_BREAK" /> Nuolydis
              </label>
              <label style="display: flex; align-items: center; gap: 4px; font-size: 13px; cursor: pointer">
                <input type="checkbox" class="obstacle-cb" value="DRAINAGE" /> Drenažas
              </label>
              <label style="display: flex; align-items: center; gap: 4px; font-size: 13px; cursor: pointer">
                <input type="checkbox" class="obstacle-cb" value="OTHER_CODED" /> Kita
              </label>
            </div>
          </div>
          <div style="margin-top: 12px">
            <button id="btnSaveSurvey" type="button" class="btn btn-secondary">Išsaugoti anketą</button>
          </div>
        </details>

        <details class="section">
          <summary>Projektai</summary>
          <div id="projectsSection"></div>
        </details>

        <details class="section">
          <summary>Skambučiai ir laiškai</summary>
          <div id="callsSection"></div>
        </details>

        <details class="section">
          <summary>Mokėjimai</summary>
          <div id="paymentsSection"></div>
        </details>

        <details class="section">
          <summary>Nuotraukos</summary>
          <div id="photosSection"></div>
        </details>

        <details class="section">
          <summary>Timeline</summary>
          <div id="timelineSection"></div>
        </details>
      </div>
    </main>

    <!-- Edit Price Modal -->
    <div class="modal-backdrop" id="editPriceBackdrop">
      <div class="modal">
        <div class="modal-header">
          <h2>Koreguoti kaina</h2>
          <button class="modal-close" id="editPriceClose">&times;</button>
        </div>
        <div class="modal-body" style="padding: 20px 24px">
          <div style="margin-bottom: 14px">
            <label style="font-size: 13px; font-weight: 600; display: block; margin-bottom: 4px">Nauja kaina (EUR)</label>
            <input type="number" id="editPriceInput" step="0.01" min="0.01" placeholder="pvz. 2300.00" />
          </div>
          <div>
            <label style="font-size: 13px; font-weight: 600; display: block; margin-bottom: 4px"
              >Priežastis (min 8 simboliai)</label
            >
            <textarea id="editPriceReason" rows="4" placeholder="Įveskite priežastį, kodėl koreguojama kaina..." maxlength="500"></textarea>
            <div id="editPriceReasonCount" class="section-subtitle" style="font-size: 12px; margin-top: 4px; color: var(--ink-muted);">0 / 8 simbolių</div>
          </div>
        </div>
        <div
          class="modal-footer"
          style="padding: 16px 24px; border-top: 1px solid var(--border); display: flex; gap: 8px; justify-content: flex-end"
        >
          <button class="btn" id="editPriceCancel">Atsaukti</button>
          <button class="btn btn-primary" id="editPriceSubmit">Išsaugoti</button>
        </div>
      </div>
    </div>

    <script src="/static/admin-shared.js?v=6.9"></script>
    <script src="/static/admin-client-card.js?v=3.4"></script>
  </body>
</html>
